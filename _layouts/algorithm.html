---
layout: default
---

<div class="algorithm-page">
    <!-- Algorithm Header -->
    <header class="algorithm-header">
        <div class="difficulty-badge difficulty-{{ page.difficulty | default: 'beginner' }}">
            {{ page.difficulty | default: 'Beginner' | capitalize }}
        </div>
        <h1 class="algorithm-title serif">{{ page.title }}</h1>

        {% if page.subtitle %}
        <p class="algorithm-subtitle">{{ page.subtitle }}</p>
        {% endif %}
    </header>

    <!-- Main Algorithm Content -->
    <div class="algorithm-content">
        {{ content }}
    </div>

    <!-- Interactive Demo Section (if enabled) -->
    {% if page.has_demo %}
    <section class="demo-section fade-in">
        <h3 class="demo-title serif">Interactive Demonstration</h3>
        <p class="demo-description">{{ page.demo_description | default: 'See the algorithm in action with live Python execution' }}</p>

        <!-- Python Loading Indicator -->
        <div id="python-loading" style="display: none;">
            Loading Python environment...
        </div>

        <!-- Demo content will be inserted here by Python scripts -->
        <div id="demo-container"></div>
    </section>
    {% endif %}

    <!-- Navigation Footer -->
    <footer class="algorithm-footer">
        <nav class="algorithm-nav">
            {% if page.previous_algorithm %}
            <a href="{{ page.previous_algorithm.url | relative_url }}" class="nav-link prev">
                ← {{ page.previous_algorithm.title }}
            </a>
            {% endif %}

            <a href="{{ '/algorithms/' | relative_url }}" class="nav-link home">
                All Algorithms
            </a>

            {% if page.next_algorithm %}
            <a href="{{ page.next_algorithm.url | relative_url }}" class="nav-link next">
                {{ page.next_algorithm.title }} →
            </a>
            {% endif %}
        </nav>
    </footer>
</div>

<!-- Pyodide Integration (if demo is enabled) -->
{% if page.has_demo %}
<script src="https://cdn.jsdelivr.net/pyodide/v0.26.4/full/pyodide.js"></script>
<script>
    let pyodide = null;

    async function initPyodide() {
        if (pyodide) return pyodide;

        const loadingEl = document.getElementById('python-loading');
        if (loadingEl) loadingEl.style.display = 'block';

        try {
            pyodide = await loadPyodide();
            await pyodide.loadPackage(['matplotlib', 'numpy']);

            pyodide.runPython(`
import matplotlib
matplotlib.use('Agg')
import matplotlib.pyplot as plt
import numpy as np
import io
import base64

def show_plot():
    buffer = io.BytesIO()
    plt.savefig(buffer, format='png', bbox_inches='tight', dpi=100)
    buffer.seek(0)
    img_str = base64.b64encode(buffer.getvalue()).decode()
    print(f'<img src="data:image/png;base64,{img_str}">')
    plt.close()

plt.show = show_plot
        `);

            if (loadingEl) loadingEl.style.display = 'none';

            const pyScriptBlocks = document.querySelectorAll('py-script');
            for (const block of pyScriptBlocks) {
                await processPythonBlock(block);
            }

        } catch (error) {
            console.error('Pyodide error:', error);
            if (loadingEl) {
                loadingEl.innerHTML = '<div style="color: red;">Error loading Python: ' + error.message + '</div>';
            }
        }
    }

    async function processPythonBlock(block) {
        try {
            const code = block.textContent.trim();
            if (!code) return;

            const outputDiv = document.createElement('div');
            outputDiv.className = 'python-output';

            let output = '';
            const originalLog = console.log;
            console.log = (...args) => {
                output += args.join(' ') + '\n';
                originalLog(...args);
            };

            pyodide.runPython(code);
            console.log = originalLog;

            if (output.trim()) {
                outputDiv.innerHTML = '<pre>' + output + '</pre>';
            } else {
                outputDiv.innerHTML = '<pre><em>Code executed successfully</em></pre>';
            }

            block.parentNode.replaceChild(outputDiv, block);

        } catch (error) {
            console.error('Python error:', error);
            const errorDiv = document.createElement('div');
            errorDiv.className = 'python-error';
            errorDiv.innerHTML = '<strong>Python Error:</strong><br>' + error.message;
            block.parentNode.replaceChild(errorDiv, block);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        if (document.querySelectorAll('py-script').length > 0) {
            initPyodide();
        }
    });
</script>
{% endif %}
